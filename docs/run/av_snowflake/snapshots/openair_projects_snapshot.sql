
      begin;
    merge into "AV_EDM_SNAPSHOTS"."OPENAIR"."OPENAIR_PROJECTS_SNAPSHOT" as DBT_INTERNAL_DEST
    using "AV_EDM_SNAPSHOTS"."OPENAIR"."OPENAIR_PROJECTS_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("ID", "NAME", "PROJECT_STAGE_ID", "START_DATE", "FINISH_DATE", "NOTES", "ACTIVE", "TB_APPROVALPROCESS", "BUDGET", "BUDGET_TIME", "USER_ID", "CUSTOM_18", "CUSTOM_90", "CUSTOM_91", "CUSTOM_94", "CUSTOM_151", "CUSTOM_157", "CUSTOM_158", "CUSTOM_166", "CUSTOM_168", "CUSTOM_183", "CUSTOM_185", "CUSTOM_189", "CUSTOM_194", "CUSTOM_195", "CUSTOM_197", "RAG_CUSTOMER_EXPERIENCE", "CUSTOM_200", "CUSTOM_223", "CUSTOM_236", "CUSTOM_245", "CUSTOM_252", "CUSTOM_309", "CUSTOM_318", "CUSTOM_322", "CUSTOM_324", "CUSTOM_327", "CUSTOM_329", "CUSTOM_331", "CUSTOM_332", "CUSTOM_333", "CUSTOM_342", "CUSTOM_364", "CUSTOM_365", "DELETED", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("ID", "NAME", "PROJECT_STAGE_ID", "START_DATE", "FINISH_DATE", "NOTES", "ACTIVE", "TB_APPROVALPROCESS", "BUDGET", "BUDGET_TIME", "USER_ID", "CUSTOM_18", "CUSTOM_90", "CUSTOM_91", "CUSTOM_94", "CUSTOM_151", "CUSTOM_157", "CUSTOM_158", "CUSTOM_166", "CUSTOM_168", "CUSTOM_183", "CUSTOM_185", "CUSTOM_189", "CUSTOM_194", "CUSTOM_195", "CUSTOM_197", "RAG_CUSTOMER_EXPERIENCE", "CUSTOM_200", "CUSTOM_223", "CUSTOM_236", "CUSTOM_245", "CUSTOM_252", "CUSTOM_309", "CUSTOM_318", "CUSTOM_322", "CUSTOM_324", "CUSTOM_327", "CUSTOM_329", "CUSTOM_331", "CUSTOM_332", "CUSTOM_333", "CUSTOM_342", "CUSTOM_364", "CUSTOM_365", "DELETED", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
    commit;
  